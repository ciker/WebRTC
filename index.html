<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>WebrtcConference Demo</title>
  <style type="text/css">
  	html,body{ width:100%;height:100%;overflow:hidden;margin:0;}
	ul{position:relative;width:100%;height:100%;margin:0;padding:0;}
	.one {position:absolute;left:25%;top:0;height:50%;width:50%;overflow:hidden;}
	.two {position:absolute;left:0;top:50%;width:50%;height:50%;overflow:hidden;}
	.three {position:absolute;left:50%;top:50%;width:50%;height:50%;overflow:hidden;}
  </style>
</head>
<body id="body">
	<button id="bigger" style="display:none;">全屏</button>
	<button id="hangupUser" style="display:none;">挂断</button>
	<button id="hiddenVideo" style="display:none;">隐藏</button>
	<button id="showVideo" style="display:none;">显示</button>
    <div id="videoList" style="position:absolute;width:100%;height:10%;display:none;z-index:999;border:1px solid black;"></div>
	<ul id="ul1" style="position:relative;width:100%;height:100%;margin:0;padding:0;z-index:0;">
		<li id="mevideoDiv"><video id="me" autoplay="true" muted="muted"></video></li>
	</ul>
	<div id="ul2" style="display:none;"></div>
</body>
<script type="text/javascript" src="/SkyRTC-client.js"></script>
<script type="text/javascript" src="/jquery-1.10.2.js"></script>
<script type="text/javascript" src="/move.js"></script>
<script type="text/javascript">

  var ul1 = document.getElementById("ul1");
  var ul2 = document.getElementById("ul2");
  var body=document.getElementById("body");
  var rtc = SkyRTC();
  var videoNum;//查看视频的个数
  var divArray;//存储li数组
  var bodyHeight= window.innerHeight;//window.screen.height;//
  var bodyWidth= window.innerWidth;//window.screen.width;//
  var roomNum = request("roomNum");//获取参数roomNum
  var userID = request("userId"); //用户id
  var userName = request("userName"); //用户姓名
  console.info("获得屏幕的高度是:"+bodyHeight+",获取屏幕的宽度是: "+bodyWidth);
  mevideoDiv.setAttribute("style","position:absolute;height:100%;width:100%;");
  //成功创建WebSocket连接
  rtc.on("connected", function(socket) {
	var audio = request("audio");
	var speaker = request("speaker");
	var videoId = request("videoId");
	audio=getParams(audio);
	speaker=getParams(speaker);
	console.info("音频状态是:"+audio+", speaker:"+speaker);
	console.info("创建WebSocket的时候audio="+audio);
	getCameraList();//获取摄像头列表
    //创建本地视频流
	if(videoId == "" || videoId == undefined || videoId == null){
		rtc.createStream({//设置分辨率是320*180//684,513//640*480
			video: {"mandatory":{"maxWidth":"1920","maxHeight":"1080"},"optional":[{"frameRate":60},{"aspectRatio":16/9}]},
			audio: audio
		});
	}else{
		rtc.createStream({//设置分辨率是320*180//684,513//640*480
			video: {mandatory:{"maxWidth":"1920","maxHeight":"1080"},"optional": [{ "sourceId": videoId},{"aspectRatio":16/9}]},
			audio: audio
		});
	}
  });
  
  
  //创建本地视频流成功
  rtc.on("stream_created", function(stream) {
    document.getElementById('me').src = URL.createObjectURL(stream);
    document.getElementById('me').play();
	/***********************LX************************/
	divArray=ul1.getElementsByTagName("li");
	console.info("创建本地视频的时候divArray.length是: "+divArray.length);
	divArray[0].setAttribute("style","display:block;width:100%;height:100%;text-align:center;");
	document.getElementById('me').setAttribute("style","text-align:center;width:100%;height:auto;");
	/***********************end**********************/	
  });
  
	//页面重新加载
  	function onload(){
		if(location.href.indexOf('#reloaded')==-1){
			location.href=location.href+"#reloaded";
			location.reload();
		}
	}

  //创建本地视频流失败
  rtc.on("stream_create_error", function() {
    alert("create stream failed!");
  });
  //接收到其他用户的视频流
  rtc.on('pc_add_stream', function(stream, socketId) {
	var videoSelect=new Array();
    var newVideo = document.createElement("video"),
        id = "other-" + socketId;
   // newVideo.setAttribute("class", "other");
    newVideo.setAttribute("autoplay", "autoplay");
    newVideo.setAttribute("id", id);
	var videoDiv = document.createElement("li");
	videoDiv.setAttribute("id",id+"videoDiv");
//	videoDiv.setAttribute("style","display:block;")
	videoDiv.appendChild(newVideo);
    ul1.appendChild(videoDiv);
	
    rtc.attachStream(stream, id);
	newVideo.ondblclick=function(event){
		newVideo.webkitRequestFullScreen();
	};
	videoNum=document.getElementsByTagName("video").length;//此处查看一共有几个视频源
	console.info("现在一共有 "+videoNum+" 个视频");
	splitScreen();
  });
  /***************************将用户信息放入到map中start*****************************/
  var socketId_videoSrc_map = new Map();
  function hiddenVideo(userId){
      if(userId == userID){
          var video = document.getElementById("me");
          var videoDiv = document.getElementById("mevideoDiv");

      }else{
          var socketObj = rtc.getUserInfoByUserId(userId);
          var socketId = socketObj.socketId;
          var video = document.getElementById('other-' + socketId);
          var videoDiv = document.getElementById('other-' + socketId + 'videoDiv');
      }
	socketId_videoSrc_map.put(userId,video.src);
    if(video){
	  var videoNum=document.getElementsByTagName("video").length;
	  var divArray=ul1.getElementsByTagName("li");
	  var divLength=divArray.length;
		for(var z=0;z<=divLength;z++){
			console.info("div的长度------: "+divArray.length);
			var appendDiv=document.getElementById("appendDiv"+z);
			if(appendDiv){
				console.info("删除appendDiv"+z);
				appendDiv.parentNode.removeChild(appendDiv);
			}
	    }
		video.parentNode.removeChild(video);
		videoDiv.parentNode.removeChild(videoDiv);
		//divScreen(videoNum);
		splitScreen();
    }
  }
  
  function showVideo(userId){
	if(userId != null){
        if(userId == userID){
            var id = "me";
        }else{
            var socketObj = rtc.getUserInfoByUserId(userId);
            var socketId = socketObj.socketId;
            var id = "other-" + socketId;
        }
        var newVideo = document.createElement("video");
        newVideo.setAttribute("autoplay", "autoplay");
		newVideo.setAttribute("id", id);
		newVideo.src = socketId_videoSrc_map.get(userId);
		
//      rtc.attachStream(stream, id);
		var videoDiv = document.createElement("li");
		videoDiv.setAttribute("id",id+"videoDiv");
	//	videoDiv.setAttribute("style","display:block;")
		videoDiv.appendChild(newVideo);
		ul1.appendChild(videoDiv);
		splitScreen();
	}else{
		alert("error, userId is null;");
	}
  }
  var hiddenVideoBtn = document.getElementById("hiddenVideo");
  hiddenVideoBtn.onclick = function(){
	hiddenVideo("xibeidiaodu");
  };
  
  var showVideoBtn = document.getElementById("showVideo");
  showVideoBtn.onclick = function(){
      showVideo("xibeidiaodu");
  };
  /***************************将用户信息放入到map中end*****************************/  

  //删除其他用户
  rtc.on('remove_peer', function(socketId) {
    var video = document.getElementById('other-' + socketId);
	var videoDiv = document.getElementById('other-' + socketId + 'videoDiv');
    if(video){
	  var videoNum=document.getElementsByTagName("video").length;
	  var divArray=ul1.getElementsByTagName("li");
	  var divLength=divArray.length;
		for(var z=0;z<=divLength;z++){
			console.info("div的长度------: "+divArray.length);
			var appendDiv=document.getElementById("appendDiv"+z);
			if(appendDiv){
				console.info("删除appendDiv"+z);
				appendDiv.parentNode.removeChild(appendDiv);
			}
	    }
		video.parentNode.removeChild(video);
		videoDiv.parentNode.removeChild(videoDiv);
		//divScreen(videoNum);
		splitScreen();
    }
  });
  
/*********************************************************挂断按钮设置*********************************************************/
  
  var hangupUser = document.getElementById("hangupUser");
  hangupUser.onclick = function(){
	hangUpMyself();
  };
  function hangUpMyself(){
	rtc.closeAllPeerConnections();
  }
  
  function getVideosNumber(){
    var videoNumber = document.getElementsByTagName("video").length;
	return videoNumber;
  }
  
  
/*********************************************************挂断按钮设置end******************************************************/
  
  function getConnection(){
	//连接WebSocket服务器
	var wsUrl = "ws:" + window.location.href.substring(window.location.protocol.length).split('#')[0];
	rtc.connect(wsUrl,roomNum, userID, userName);
	console.log("连接 WebSocket服务器:"+wsUrl,roomNum);
  }
  setTimeout("getConnection()",parseInt(1200*Math.random()));

  //监听浏览器窗口的大小

  var bigger = document.getElementById("bigger");
  bigger.onclick=function(){
		fullScreen();
	};
/*******************************************************获取摄像头列表begin**************************************************/
	var  getCameraList = function(){
	  var mediaElement = document.getElementById('me');
      if (!MediaStreamTrack) document.body.innerHTML = '<h1>Incompatible Browser Detected. Try <strong style="color:red;">Chrome Canary</strong> instead.</h1>';
      var videoSources = [];
      MediaStreamTrack.getSources(function(media_sources) {
        media_sources.forEach(function(media_source){
          if (media_source.kind === 'video') {
            videoSources.push(media_source);
          }
        });
        getMediaSource(videoSources);
      });

      var get_and_show_media1 = function(id) {	  //给摄像头赋名称
        var constraints = {};
        constraints.video = {
          mandatory:{"maxWidth":"1920","maxHeight":"1080"},
          optional: [{ sourceId: id},{aspectRatio:16/9}]
        };
        navigator.webkitGetUserMedia(constraints, function(stream) {
          var track = stream.getVideoTracks()[0];
  		  console.log( "camera's name: "+ track.label +", camera's id is "+id);
		  if(track.label == "Virtual Cam"){
			$("#"+id).val("屏幕共享");
			document.getElementById(id+"btnDiv").firstChild.src="/shexiangtou/icon_nei_wang.png";//获取摄像头的元素
			//console.log("document.getElementById().firstChild.src: "+document.getElementById().firstChild.src);
		  }else{
			$("#"+id).val(track.label);
		  }
		  if (!!stream) {
		  	console.log("the camera : "+track.label+" stream is stop.");
			stream.stop();
		  }
        }, function (e){
          document.body.appendChild(document.createElement('hr'));
          var strong = document.createElement('strong');
          strong.innerHTML = JSON.stringify(e);
          console.log('strong.innerHTML : '+strong.innerHTML);
          document.body.appendChild(strong);
        });
      };
/**************************************************选中的摄像头begin****************************************************/  
      var get_and_show_media = function(id) {
		var videoId = request("videoId");
		var url = location.href; 
		if(videoId == "" || videoId == undefined || videoId == null){
			location.href=location.href+"&videoId="+id;
		}else{
			location.href=url.substring(0,location.href.indexOf("&videoId"))+"&videoId="+id;
		}
		console.log("location.href=="+location.href);
		location.reload();//页面重载
      };
/***************************************************选中摄像头end**************************************************/    
      var getMediaSource = function(media) {
      	var a = 1/videoSources.length;
      	var b=a.toFixed(4);
      	var btnWidthStyle = b.slice(2,4)+"."+b.slice(4,6)+"%";
        console.log(media);
        media.forEach(function(media_source) {
          if (!media_source) return;
          if (media_source.kind === 'video') 
          {
            // add buttons for each media item
			var btnDiv =  document.createElement("div");
			btnDiv.setAttribute("id",media_source.id+"btnDiv");
			btnDiv.setAttribute("style","position:relative;float:left;width:"+btnWidthStyle+";height:1%;background-color:black;opacity:0.58");//background-image:url(/shexiangtou/MouseOver-.png);
			$("#videoList").append(btnDiv);
			var icon_she_xiang_tou=document.createElement("img");
			icon_she_xiang_tou.src="/shexiangtou/icon_she_xiang_tou.png";
			icon_she_xiang_tou.setAttribute("style","position:relative;width:4%;opacity:0.58;");
			
			btnDiv.appendChild(icon_she_xiang_tou);
			var btn = document.createElement("input");
			btn.setAttribute("id",media_source.id);
			btn.setAttribute("type","button");
			btn.setAttribute("value","摄像头");
			btn.setAttribute("style","position:absolute;width:95%;height:100%; font-size:120%;color:rgb(237,237,237);background-color:black;border:0;opacity:0.58;");
			btnDiv.appendChild(btn);

			var feng_ge_xian=document.createElement("img");
			feng_ge_xian.src="/shexiangtou/feng_ge_xian.png";
			feng_ge_xian.setAttribute("style","position:relative;width:1%;height:20px;");
			btnDiv.appendChild(feng_ge_xian);
            // show video on click
            $(document).on("click", "#"+media_source.id, function(e){
            if (window.stream) {
    			mediaElement.src = null;
    			window.stream.stop();
    			console.log("videoElement: "+mediaElement);
 			 }
			  var btnDiv = document.getElementById(media_source.id+"btnDiv");
			  btnDiv.setAttribute("style","background-image:url(/shexiangtou/MouseDown.png;)");
			  //rtc.closeAllPeerConnections();//关闭所有流
              get_and_show_media(media_source.id);
            });
			
			$(document).on("mouserover", "#"+media_source.id+"btnDiv", function(e){
			  var btnDiv = document.getElementById(media_source.id+"btnDiv");
			  btnDiv.setAttribute("style","background-image:url(/shexiangtou/MouseOver-.png);");
            });
          }
          get_and_show_media1(media_source.id);
        });
      }
	};

/*******************************************************获取摄像头列表end**********************************************/
	
/***************************************************实时获取鼠标位置begin********************************************************/
 var getCoordInDocument = function(e) {
 e = e || window.event;
 var x = e.pageX || (e.clientX +(document.documentElement.scrollLeft|| document.body.scrollLeft));
 var y= e.pageY || (e.clientY +(document.documentElement.scrollTop|| document.body.scrollTop));
 return {'x':x,'y':y};
}
 var computedStyle = document.defaultView.getComputedStyle(document.getElementById("videoList"), null);
 body.onmousemove = function(e){
	var pointer = getCoordInDocument(e);
	if(pointer.y < 50){
		if(computedStyle.display == "block"){
			console.info("computedStyle.display: "+computedStyle.display);
		}else{
			document.getElementById("videoList").setAttribute("style","position:absolute;width:100%;z-index:999;background-color:transparent;");//display:block;
			/*************************************************缓慢显示begin*******************************************/
			//$("#videoList").show(1000,function(){
			//	$(this).attr("style","position:absolute;width:100%;z-index:999;background-color:transparent;");
			//});
			/*************************************************缓慢显示end*****************************************/
		}	
	  }else{
			document.getElementById("videoList").setAttribute("style","position:absolute;width:100%;display:none;z-index:999;");
			//fadeOut(document.getElementById("videoList"), "slow");
			//$("#videoList").hide(1000);
	  }
 }
/***************************************************实时获取鼠标位置end*****************************************************/


/*******************************************************按数字分屏begin************************************************************/
 function divScreen(num){
		//alert("现在开始 "+num+" 分屏");
		videoNum=document.getElementsByTagName("video").length;//此处查看一共有几个视频源
		divArray=ul1.getElementsByTagName("li");
		var divLength=divArray.length;
		
		for(var z=0;z<=divLength;z++){
			var appendDiv=document.getElementById("appendDiv"+z);
			if(appendDiv){
				appendDiv.parentNode.removeChild(appendDiv);
			}
	    }
		
		if(num===1){
		if(num<=videoNum){
			divArray[0].setAttribute("style","");
			divArray[0].setAttribute("style","width:100%;height:100%;text-align:center;");
			document.getElementById('me').setAttribute("style","text-align:center;width:100%;height:auto;");
				for(var j=num+1;j<=divArray.length && divArray[j];j++){
					divArray[j].setAttribute("style","display:none;");
				}
			}else{
					for(var x=videoNum+1;x<=num;x++){
						var li=document.createElement("li");
						li.setAttribute("id","appendDiv"+x);
						li.setAttribute("style","overflow:hidden;");
						var img=document.createElement("img");
						img.src="/defaultConf.bmp";
						img.setAttribute("width","100%");
						li.appendChild(img);
						ul1.appendChild(li);
				}
			divArray[0].setAttribute("style","");
			divArray[0].setAttribute("style","width:100%;height:100%;text-align:center;");
			document.getElementById('me').setAttribute("style","text-align:center;width:100%;height:auto;");
			}			
		}
		if(num===2){//特别注意2分屏和之前的不同
		if(num<=videoNum){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:100%;width:50%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:100%;width:50%;overflow:hidden;");
			for(var j=num+1;j<=divArray.length && divArray[j];j++){
				divArray[j].setAttribute("style","display:none;");
			}
			}else{
					for(var x=videoNum+1;x<=num;x++){
						var li=document.createElement("li");
						li.setAttribute("id","appendDiv"+x);
						li.setAttribute("style","overflow:hidden;");
						var img=document.createElement("img");
						img.src="/defaultConf.bmp";
						img.setAttribute("style","width:100%;height:auto;");
						li.appendChild(img);
						ul1.appendChild(li);
				}
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:100%;width:50%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:100%;width:50%;overflow:hidden;");
			}		
		}
		if(num===3){
		if(num<=videoNum){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:25%;height:50%;width:50%; overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:0;top:50%;width:50%;height:50%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:50%;top:50%;width:50%;height:50%;overflow:hidden;");	
			for(var j=num+1;j<=divArray.length&& divArray[j];j++){
					divArray[j].setAttribute("style","display:none;");
				}
			}else{
				for(var x=videoNum+1;x<=num;x++){
					var li=document.createElement("li");
					li.setAttribute("id","appendDiv"+x);
					li.setAttribute("style","overflow:hidden;");					
					var img=document.createElement("img");
					img.src="/defaultConf.bmp";
					img.setAttribute("width","100%");
					li.appendChild(img);
					ul1.appendChild(li);
				}
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:25%;height:50%;width:50%; overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:0;top:50%;width:50%;height:50%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:50%;top:50%;width:50%;height:50%;overflow:hidden;");	
			}
		}
		if(num===4){
		if(num<=videoNum){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:0;top:50%;height:50%;width:50%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:50%;top:50%;height:50%;width:50%;overflow:hidden;");	
				for(var j=num+1;j<=divArray.length && divArray[j];j++){
					divArray[j].setAttribute("style","display:none;");
				}
		}else{
			for(var x=videoNum+1;x<=num;x++){
				var li=document.createElement("li");
				li.setAttribute("id","appendDiv"+x);
				li.setAttribute("style","overflow:hidden;");
				var img=document.createElement("img");
				img.src="/defaultConf.bmp";
				img.setAttribute("width","100%");
				li.appendChild(img);
				ul1.appendChild(li);
			}
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:0;top:50%;height:50%;width:50%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:50%;top:50%;height:50%;width:50%;overflow:hidden;");	
            }
		}
		if(num===5){
		if(num<=videoNum){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:80%;width:100%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:0;top:80%;height:20%;width:25%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:25%;top:80%;height:20%;width:25%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:50%;top:80%;height:20%;width:25%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:75%;top:80%;height:20%;width:25%;overflow:hidden;");
			for(var j=num+1;j<=divArray.length && divArray[j];j++){
					divArray[j].setAttribute("style","display:none;");
				}
			}else{
				for(var x=videoNum+1;x<=num;x++){
					var li=document.createElement("li");
					li.setAttribute("id","appendDiv"+x);
					li.setAttribute("style","overflow:hidden;");
					var img=document.createElement("img");
					img.src="/defaultConf.bmp";
					img.setAttribute("width","100%");
					li.appendChild(img);
					ul1.appendChild(li);
				}
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:80%;width:100%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:0;top:80%;height:20%;width:25%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:25%;top:80%;height:20%;width:25%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:50%;top:80%;height:20%;width:25%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:75%;top:80%;height:20%;width:25%;overflow:hidden;");

			}
		}
		if(num===6){
		if(num<=videoNum){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:66.7%;width:66.7%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:66.7%;top:0;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:66.7%;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:66.7%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:0;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:33.3%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			for(var j=num+1;j<=divArray.length && divArray[j];j++){
				divArray[j].setAttribute("style","display:none;");
			}
			}else{
				for(var x=videoNum+1;x<=num;x++){
					var li=document.createElement("li");
					li.setAttribute("id","appendDiv"+x);
					li.setAttribute("style","overflow:hidden;");
					var img=document.createElement("img");
					img.src="/defaultConf.bmp";
					img.setAttribute("width","100%");
					li.appendChild(img);
					ul1.appendChild(li);
				}
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:66.7%;width:66.7%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:66.7%;top:0;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:66.7%;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:66.7%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:0;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:33.3%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			}
		}
		
		if(num===7){
		if(num<=videoNum){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:0;top:50%;height:50%;width:50%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:50%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[6].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
			for(var j=num+1;j<=divArray.length && divArray[j];j++){
				divArray[j].setAttribute("style","display:none;");
			}
			}else{
				for(var x=videoNum+1;x<=num;x++){
					var li=document.createElement("li");
					li.setAttribute("id","appendDiv"+x);
					li.setAttribute("style","overflow:hidden;");
					var img=document.createElement("img");
					img.src="/defaultConf.bmp";
					img.setAttribute("width","100%");
					li.appendChild(img);
					ul1.appendChild(li);
				}
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:0;top:50%;height:50%;width:50%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:50%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[6].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
			}
		}
		
		if(num===8){
		if(num<=videoNum){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:75%;width:75%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:75%;top:0;height:25%;width:25%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:75%;top:25%;height:25%width:25%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:0;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[6].setAttribute("style","position:absolute;left:25%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[7].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
			for(var j=num+1;j<=divArray.length && divArray[j];j++){
				divArray[j].setAttribute("style","display:none;");
			}
			}else{
				for(var x=videoNum+1;x<=num;x++){
					var li=document.createElement("li");
					li.setAttribute("id","appendDiv"+x);
					li.setAttribute("style","overflow:hidden;");
					var img=document.createElement("img");
					img.src="/defaultConf.bmp";
					img.setAttribute("width","100%");
					li.appendChild(img);
					ul1.appendChild(li);
				}
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:75%;width:75%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:75%;top:0;height:25%;width:25%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:75%;top:25%;height:25%width:25%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:0;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[6].setAttribute("style","position:absolute;left:25%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[7].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
			}
		}
		
		if(num===9){
		if(num<=videoNum){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:33.3%;top:0;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:66.7%;top:0;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:0;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:33.3%;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:66.7%;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[6].setAttribute("style","position:absolute;left:0;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[7].setAttribute("style","position:absolute;left:33.3%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[8].setAttribute("style","position:absolute;left:66.7%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			for(var j=num+1;j<=divArray.length && divArray[j];j++){
				divArray[j].setAttribute("style","display:none;");
			}
			}else{
				for(var x=videoNum+1;x<=num;x++){
					var li=document.createElement("li");
					li.setAttribute("id","appendDiv"+x);
					li.setAttribute("style","overflow:hidden;");
					var img=document.createElement("img");
					img.src="/defaultConf.bmp";
					img.setAttribute("width","100%");
					li.appendChild(img);
					ul1.appendChild(li);
				}
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:33.3%;top:0;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:66.7%;top:0;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:0;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:33.3%;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:66.7%;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[6].setAttribute("style","position:absolute;left:0;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[7].setAttribute("style","position:absolute;left:33.3%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			divArray[8].setAttribute("style","position:absolute;left:66.7%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
			}
		}
		
		if(num===10){
		if(num<=videoNum){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:0;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:25%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:50%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[6].setAttribute("style","position:absolute;left:0;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[7].setAttribute("style","position:absolute;left:25%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[8].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[9].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
			for(var j=num+1;j<=divArray.length && divArray[j];j++){
				divArray[j].setAttribute("style","display:none;");
			}
			}else{
				for(var x=videoNum+1;x<=num;x++){
					var li=document.createElement("li");
					li.setAttribute("id","appendDiv"+x);
					li.setAttribute("style","overflow:hidden;");
					var img=document.createElement("img");
					img.src="/defaultConf.bmp";
					img.setAttribute("width","100%");
					li.appendChild(img);
					ul1.appendChild(li);
				}
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:0;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:25%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:50%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[6].setAttribute("style","position:absolute;left:0;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[7].setAttribute("style","position:absolute;left:25%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[8].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[9].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
			}
		}
		drag();//读取位置信息
  } 
/******************************************************按数字分屏end**********************************************************/

  /************************************************自动分屏begin************************************************************/
 
  function clearStyle(divArray,videoNum){
		for(var i=0; i<videoNum; i++){
			divArray[i].setAttribute("style","");
			divArray[i].childNodes.item(0).setAttribute("style","width:100%;height:auto;muted:muted;");
		}
	}
  
  function splitScreen(){

  	var videoNum=ul1.getElementsByTagName("video").length;//此处查看一共有几个视频源
  	var divArray=ul1.getElementsByTagName("li");
	var divArrayLength = divArray.length;
	for(var i=0;i<=divArrayLength;i++){
		var appendDiv=document.getElementById("appendDiv"+i);
		if(appendDiv){
			appendDiv.parentNode.removeChild(appendDiv);
		}
	}
	console.info("开始分屏,此时divArray.length: "+divArrayLength+", videoNum:"+videoNum);
	if(videoNum===1){
		divArray[0].setAttribute("style","");
		divArray[0].setAttribute("style","width:100%;height:100%;text-align:center;");
		document.getElementById('me').setAttribute("style","text-align:center;width:100%;height:auto;");
	}
	if(videoNum===2){
		clearStyle(divArray,videoNum);
		divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:100%;width:50%;display:none;");
		//divArray[2].setAttribute("style","position:absolute;left:"+0.5*bodyWidth+"px;top:0;height:"+bodyHeight+"px;width:"+0.5*bodyWidth+"px;");
		divArray[1].setAttribute("style","text-align:center;width:100%;height:100%;display:block;");
		
		/*var shipin1=document.getElementById("shipin1");
		shipin1.onclick=function(event){
			divArray[1].childNodes.item(0).webkitRequestFullScreen();
		}
		var shipin2=document.getElementById("shipin2")
		shipin2.onclick=function(event ){
			divArray[2].childNodes.item(0).webkitRequestFullScreen();
		}*/
	}
	if(videoNum===3){
		clearStyle(divArray,videoNum);
		divArray[0].setAttribute("style","position:absolute;left:25%;top:0;height:50%;width:50%;overflow:hidden;");
		divArray[1].setAttribute("style","position:absolute;left:0;top:50%;width:50%;height:50%;overflow:hidden;");
        divArray[2].setAttribute("style","position:absolute;left:50%;top:50%;width:50%;height:50%;overflow:hidden;");	
	}
	if(videoNum===4){
		clearStyle(divArray,videoNum);
		divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:50%;width:50%;overflow:hidden;");
		divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:50%;width:50%;overflow:hidden;");
		divArray[2].setAttribute("style","position:absolute;left:0;top:50%;height:50%;width:50%;overflow:hidden;");
        divArray[3].setAttribute("style","position:absolute;left:50%;top:50%;height:50%;width:50%;overflow:hidden;");
	}
	if(videoNum===5){
		clearStyle(divArray,videoNum);
		divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:80%;width:100%;overflow:hidden;");
		divArray[1].setAttribute("style","position:absolute;left:0;top:80%;height:20%;width:25%;overflow:hidden;");
		divArray[2].setAttribute("style","position:absolute;left:25%;top:80%;height:20%;width:25%;overflow:hidden;");
		divArray[3].setAttribute("style","position:absolute;left:50%;top:80%;height:20%;width:25%;overflow:hidden;");
		divArray[4].setAttribute("style","position:absolute;left:75%;top:80%;height:20%;width:25%;overflow:hidden;");
	}
	if(videoNum===6){
		clearStyle(divArray,videoNum);
		divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:66.7%;width:66.7%;overflow:hidden;");
		divArray[1].setAttribute("style","position:absolute;left:66.7%;top:0;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[2].setAttribute("style","position:absolute;left:66.7%;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
        divArray[3].setAttribute("style","position:absolute;left:66.7%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[4].setAttribute("style","position:absolute;left:0;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[5].setAttribute("style","position:absolute;left:33.3%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
	}
	if(videoNum===7){
		clearStyle(divArray,videoNum);
		divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:50%;width:50%;overflow:hidden;");
		divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:50%;width:50%;overflow:hidden;");
		divArray[2].setAttribute("style","position:absolute;left:0;top:50%;height:50%;width:50%;overflow:hidden;");
        divArray[3].setAttribute("style","position:absolute;left:50%;top:50%;height:25%;width:25%;overflow:hidden;");
		divArray[4].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
		divArray[5].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
		divArray[6].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
	}
	if(videoNum===8){
		clearStyle(divArray,videoNum);
		divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:75%;width:75%;overflow:hidden;");
		divArray[1].setAttribute("style","position:absolute;left:75%;top:0;height:25%;width:25%;overflow:hidden;");
		divArray[2].setAttribute("style","position:absolute;left:75%;top:25%;height:25%width:25%;overflow:hidden;");
        divArray[3].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
		divArray[4].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
		divArray[5].setAttribute("style","position:absolute;left:0;top:75%;height:25%;width:25%;overflow:hidden;");
		divArray[6].setAttribute("style","position:absolute;left:25%;top:75%;height:25%;width:25%;overflow:hidden;");
		divArray[7].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
	}
	if(videoNum===9){
		clearStyle(divArray,videoNum);
		divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[1].setAttribute("style","position:absolute;left:33.3%;top:0;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[2].setAttribute("style","position:absolute;left:66.7%;top:0;height:33.3%;width:33.3%;overflow:hidden;");
        divArray[3].setAttribute("style","position:absolute;left:0;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[4].setAttribute("style","position:absolute;left:33.3%;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[5].setAttribute("style","position:absolute;left:66.7%;top:33.3%;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[6].setAttribute("style","position:absolute;left:0;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[7].setAttribute("style","position:absolute;left:33.3%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
		divArray[8].setAttribute("style","position:absolute;left:66.7%;top:66.7%;height:33.3%;width:33.3%;overflow:hidden;");
	}
	if(videoNum===10){
			clearStyle(divArray,videoNum);
			divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[1].setAttribute("style","position:absolute;left:50%;top:0;height:50%;width:50%;overflow:hidden;");
			divArray[2].setAttribute("style","position:absolute;left:0;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[3].setAttribute("style","position:absolute;left:25%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[4].setAttribute("style","position:absolute;left:50%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[5].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
			divArray[6].setAttribute("style","position:absolute;left:0;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[7].setAttribute("style","position:absolute;left:25%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[8].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
			divArray[9].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
	}
	if(videoNum===16){
		clearStyle(divArray,videoNum);
		divArray[0].setAttribute("style","position:absolute;left:0;top:0;height:25%;width:25%;overflow:hidden;");
		divArray[1].setAttribute("style","position:absolute;left:25%;top:0;height:25%;width:25%;overflow:hidden;");
		divArray[2].setAttribute("style","position:absolute;left:50%;top:0;height:25%;width:25%;overflow:hidden;");
        divArray[3].setAttribute("style","position:absolute;left:75%;top:0;height:25%;width:25%;overflow:hidden;");
		divArray[4].setAttribute("style","position:absolute;left:0;top:25%;height:25%;width:25%;overflow:hidden;");
		divArray[5].setAttribute("style","position:absolute;left:25%;top:25%;height:25%;width:25%;overflow:hidden;");
		divArray[6].setAttribute("style","position:absolute;left:50%;top:25%;height:25%;width:25%;overflow:hidden;");
		divArray[7].setAttribute("style","position:absolute;left:75%;top:25%;height:25%;width:25%;overflow:hidden;");
		divArray[8].setAttribute("style","position:absolute;left:0;top:50%;height:25%;width:25%;overflow:hidden;");
		divArray[9].setAttribute("style","position:absolute;left:25%;top:50%;height:25%;width:25%;overflow:hidden;");
		divArray[10].setAttribute("style","position:absolute;left:50%;top:50%;height:25%;width:25%;overflow:hidden;");
		divArray[11].setAttribute("style","position:absolute;left:75%;top:50%;height:25%;width:25%;overflow:hidden;");
		divArray[12].setAttribute("style","position:absolute;left:0;top:75%;height:25%;width:25%;overflow:hidden;");
        divArray[13].setAttribute("style","position:absolute;left:25%;top:75%;height:25%;width:25%;overflow:hidden;");
		divArray[14].setAttribute("style","position:absolute;left:50%;top:75%;height:25%;width:25%;overflow:hidden;");
		divArray[15].setAttribute("style","position:absolute;left:75%;top:75%;height:25%;width:25%;overflow:hidden;");
	}
		drag();//读取位置信息
		if(videoNum === 2){
			bound.jSVideoNum("'"+videoNum+"'",'');
		}
  }
  /**********************************************自动分屏end**************************************************************/


  
</script>
</html>
